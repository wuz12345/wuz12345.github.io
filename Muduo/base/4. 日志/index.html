
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="wuzhuang">
      
      
        <meta name="author" content="wuzhuang">
      
      
        <link rel="canonical" href="https://wuz12345.github.io/Muduo/base/4.%20%E6%97%A5%E5%BF%97/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>日志 - wuzhuang</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="wuzhuang" class="md-header__button md-logo" aria-label="wuzhuang" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            wuzhuang
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              日志
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/wuz12345/mynote/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="wuzhuang" class="md-nav__button md-logo" aria-label="wuzhuang" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    wuzhuang
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wuz12345/mynote/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        简介
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        关于
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          LearnC++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="LearnC++" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          LearnC++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LearnC%2B%2B/%E6%8B%B7%E8%B4%9D%E8%B5%8B%E5%80%BC/" class="md-nav__link">
        拷贝赋值
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Effiective Modern C++
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Effiective Modern C++" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Effiective Modern C++
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LearnC%2B%2B/Effective%20C%2B%2B/Item01/" class="md-nav__link">
        item1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LearnC%2B%2B/Effective%20C%2B%2B/Item02/" class="md-nav__link">
        item2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LearnC%2B%2B/Effective%20C%2B%2B/Item07/" class="md-nav__link">
        item7
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LearnC%2B%2B/%E5%B7%A6%E5%80%BC%E4%B8%8E%E5%8F%B3%E5%80%BC/" class="md-nav__link">
        左值与右值
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          LeetCode刷题
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="LeetCode刷题" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          LeetCode刷题
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode%20%E5%88%B7%E9%A2%98/Zigzag-Conversion/" class="md-nav__link">
        之字形转换
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode%20%E5%88%B7%E9%A2%98/%E7%BA%BF%E6%80%A7%E8%A1%A8/" class="md-nav__link">
        线性表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          有趣的知识
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="有趣的知识" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          有趣的知识
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%9F%A5%E8%AF%86/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8E%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/" class="md-nav__link">
        正则表达式与有限状态机
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          webRTC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="webRTC" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          webRTC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../webrtc/FEC/FEC/" class="md-nav__link">
        FEC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#logger" class="md-nav__link">
    日志类 Logger
  </a>
  
    <nav class="md-nav" aria-label="日志类 Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logstream" class="md-nav__link">
    缓冲流 LogStream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logfile" class="md-nav__link">
    滚动日志 LogFile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logger-logfile" class="md-nav__link">
    Logger &amp;&amp; LogFile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    细节
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/wuz12345/mynote/edit/master/docs/Muduo/base/4. 日志.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="_1">日志<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<ul>
<li><strong><em><code>Logger</code></em></strong></li>
<li><strong><em><code>LogFile</code></em></strong></li>
</ul>
<h2 id="logger">日志类 <strong><em>Logger</em></strong><a class="headerlink" href="#logger" title="Permanent link">&para;</a></h2>
<p><em><code>loggering --&gt; Impl --&gt; LogStream --&gt; operator&lt;&lt; --&gt; FixedBuffer --&gt; g_output --&gt; flush</code></em></p>
<p><img alt="image-20200601211221489" src="https://i.loli.net/2020/06/01/UFqg8IzvJjdwNcT.png" /></p>
<p><div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">Logger</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">enum</span><span class="w"> </span><span class="nc">LogLevel</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TRACE</span><span class="p">,</span><span class="w"> </span><span class="n">DEBUG</span><span class="p">,</span><span class="w"> </span><span class="n">INFO</span><span class="p">,</span><span class="w"> </span><span class="n">WARN</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">FATAL</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_LOG_LEVELS</span><span class="p">};</span><span class="w"></span>

<span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">SourceFile</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span><span class="w"> </span><span class="c1">// 文件名首地址</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span><span class="w">         </span><span class="c1">// 文件的字符个数</span>
<span class="w">            </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">Impl</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="n">Timestamp</span><span class="w"> </span><span class="n">time_</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">LogStream</span><span class="w"> </span><span class="n">stream_</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">LogLevel</span><span class="w"> </span><span class="n">level_</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">line_</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">SourceFile</span><span class="w"> </span><span class="n">basename_</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">Impl</span><span class="w"> </span><span class="n">impl_</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
+ 原理：  <br />
整个<code>Logger</code>内部是靠类 <strong><em><code>Impl</code></em></strong> 和类 <strong><em><code>SourceFile</code></em></strong> 实现的：</p>
<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="w"> </span><span class="n">日志等级</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="n n-Quoted">`LogLevel`</span><span class="o">***</span><span class="w"> </span><span class="n">，分为6个等级，由</span><span class="n n-Quoted">`g_logLevel`</span><span class="n">指定。</span><span class="w"></span>
<span class="o">+</span><span class="w"> </span><span class="n">类</span><span class="n n-Quoted">`Impl`</span><span class="n">内部包含了一个缓冲流</span><span class="n n-Quoted">`LogStream`</span><span class="n">对象实现缓冲</span><span class="w">  </span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">通过</span><span class="n n-Quoted">`Logger`</span><span class="n">的构造函数来初始化成员变量</span><span class="n n-Quoted">`impl`</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">cpp</span>
<span class="n n-Quoted">        Logger::Impl::Impl(LogLevel level, int savedErrno, const SourceFile&amp; file, int line)</span>
<span class="n n-Quoted">        : time_(Timestamp::now()), stream_(),</span>
<span class="n n-Quoted">          level_(level), line_(line), basename_(file) </span>
<span class="n n-Quoted">        {</span>
<span class="n n-Quoted">            formatTime();</span>
<span class="n n-Quoted">            CurrentThread::tid();</span>
<span class="n n-Quoted">            stream_ &lt;&lt; T(CurrentThread::tidString(), 6);</span>
<span class="n n-Quoted">            stream_ &lt;&lt; T(LogLevelName[level], 6);</span>
<span class="n n-Quoted">            if (savedErrno != 0) {</span>
<span class="n n-Quoted">                stream_ &lt;&lt; strerror_tl(savedErrno) &lt;&lt; &quot; (errno=&quot; &lt;&lt; savedErrno &lt;&lt; &quot;) &quot;;</span>
<span class="n n-Quoted">            }</span>
<span class="n n-Quoted">        }</span>
<span class="n n-Quoted">        </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span><span class="w"></span>
<span class="w">        </span><span class="n">在构造</span><span class="n n-Quoted">`impl`</span><span class="n">时，由</span><span class="n n-Quoted">`Logger`</span><span class="n">构造函数传入三个等级</span><span class="o">:</span><span class="n">日志等级</span><span class="n n-Quoted">`level_`</span><span class="n">，以及行号</span><span class="n n-Quoted">`line_`</span><span class="n">和文件名</span><span class="n n-Quoted">`basename_`</span><span class="n">。</span><span class="n n-Quoted">`Impl`</span><span class="n">自己初始化</span><span class="n n-Quoted">`time_`</span><span class="n">和</span><span class="n n-Quoted">`stream_`</span><span class="n">。</span><span class="w"> </span><span class="n">通过</span><span class="n n-Quoted">`stream_`</span><span class="n">来实现对象的缓冲。至于具体缓冲到哪里，由类</span><span class="n n-Quoted">`LogStream`</span><span class="n">决定，</span><span class="n n-Quoted">`LogStream`</span><span class="n">重载了运算操作符号</span><span class="n n-Quoted">`&lt;&lt;`</span><span class="n">。</span><span class="w"></span>

<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">由</span><span class="n n-Quoted">`SourceFile`</span><span class="n">来获取文件名及文件名字符数。</span><span class="w"> </span>
<span class="o">+</span><span class="w"> </span><span class="n">构造函数</span><span class="w"></span>
<span class="w">    </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">cpp</span>
<span class="n n-Quoted">        Logger(SourceFile file, int line);</span>
<span class="n n-Quoted">        Logger(SourceFile file, int line, LogLevel level);</span>
<span class="n n-Quoted">        Logger(SourceFile file, int line, LogLevel level, const char* func);</span>
<span class="n n-Quoted">        Logger(SourceFile file, int line, bool toAbort);</span>
<span class="n n-Quoted">        ~Logger();</span>
<span class="n n-Quoted">    </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span><span class="w"></span>
<span class="w">    </span><span class="n">默认日志等级是</span><span class="n n-Quoted">`INFO`</span><span class="n">，可通过</span><span class="n n-Quoted">`level`</span><span class="n">改变</span><span class="w"></span>
<span class="o">+</span><span class="w"> </span><span class="n">缓冲目的地</span><span class="w">  </span>
<span class="w">    </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">cpp</span>
<span class="n n-Quoted">    class Logger {</span>
<span class="n n-Quoted">    public:</span>
<span class="n n-Quoted">        typedef void (*OutputFunc)(const char* msg, int len);   </span>
<span class="n n-Quoted">        typedef void (*FlushFunc)();</span>
<span class="n n-Quoted">        static void setOutput(OutputFunc);</span>
<span class="n n-Quoted">        static void setFlush(FlushFunc);</span>
<span class="n n-Quoted">        ...</span>
<span class="n n-Quoted">    };</span>
<span class="n n-Quoted">    </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span><span class="w"></span>
<span class="w">    </span><span class="n">可以由上述两个函数进行设置改变。默认下缓冲输出到标准输出</span><span class="n n-Quoted">`stdout`</span><span class="n">。</span><span class="w"></span>
<span class="w">    </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">cpp</span>
<span class="n n-Quoted">        Logger::~Logger() {</span>
<span class="n n-Quoted">            impl_.finish();</span>
<span class="n n-Quoted">            const LogStream::Buffer&amp; buf(stream().buffer());</span>
<span class="n n-Quoted">            // 把buf内容输出到stdout</span>
<span class="n n-Quoted">            g_output(buf.data(), buf.length());</span>
<span class="n n-Quoted">            if (impl_.level_ == FATAL) {</span>
<span class="n n-Quoted">                    g_flush();</span>
<span class="n n-Quoted">                    abort();</span>
<span class="n n-Quoted">            }</span>
<span class="n n-Quoted">        }</span>
<span class="n n-Quoted">    </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span><span class="w"></span>
<span class="w">    </span><span class="n">在</span><span class="n n-Quoted">`Logger`</span><span class="n">析构时，获取缓冲区并且将缓冲区的内容成输出到</span><span class="n n-Quoted">`g_output`</span><span class="n">指定的地方。</span><span class="w">  </span>
<span class="o">+</span><span class="w"> </span><span class="n">使用</span><span class="w">  </span>
<span class="w">    </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">c</span>
<span class="n n-Quoted">        #define LOG_TRACE \</span>
<span class="n n-Quoted">            if (muduo::Logger::logLevel() &lt;= muduo::Logger::TRACE) \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, muduo::Logger::TRACE, __func__).stream()  </span>
<span class="n n-Quoted">        #define LOG_DEBUG  \ </span>
<span class="n n-Quoted">            if (muduo::Logger::logLevel() &lt;= muduo::Logger::DEBUG) \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, muduo::Logger::DEBUG, __func__).stream()</span>
<span class="n n-Quoted">        #define LOG_INFO   \ </span>
<span class="n n-Quoted">            if (muduo::Logger::logLevel() &lt;= muduo::Logger::INFO)   \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__).stream()</span>
<span class="n n-Quoted">        #define LOG_WARN     \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, muduo::Logger::WARN).stream()</span>
<span class="n n-Quoted">        #define LOG_ERROR    \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, muduo::Logger::ERROR).stream()</span>
<span class="n n-Quoted">        #define LOG_FATAL    \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, muduo::Logger::FATAL).stream()</span>
<span class="n n-Quoted">        #define LOG_SYSERR   \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, false).stream()</span>
<span class="n n-Quoted">        #define LOG_SYSFATAL \</span>
<span class="n n-Quoted">                muduo::Logger(__FILE__, __LINE__, true).stream()</span>
<span class="n n-Quoted">    </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span><span class="w"></span>
<span class="w">    </span><span class="n">通过使用宏定义来使用这个</span><span class="n n-Quoted">`Logger`</span><span class="n">，可以通过函数</span><span class="w"> </span><span class="o">***</span><span class="n n-Quoted">`static void setLogLevel(LogLevel level);`</span><span class="o">***</span><span class="w"> </span><span class="n">来决定使用哪个宏。</span><span class="w"></span>
</code></pre></div>

<h3 id="logstream">缓冲流 <strong><em>LogStream</em></strong><a class="headerlink" href="#logstream" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">LogStream</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">boost</span><span class="o">::</span><span class="n">noncopyable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="k">typedef</span><span class="w"> </span><span class="n">detail</span><span class="o">::</span><span class="n">FixedBuffer</span><span class="o">&lt;</span><span class="n">detail</span><span class="o">::</span><span class="n">kSmallBuffer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Buffer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">self</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(...);</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">buffer_</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">resetBuffer</span><span class="p">()</span><span class="w"> </span><span class="p">;</span><span class="w">    </span><span class="c1">// 只是重置缓冲区的cur_指针到初始位置，数据没有删除。</span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer_</span><span class="p">;</span><span class="w"> </span><span class="c1">// 定义一个缓冲区，将所有的数据先写入缓冲区中</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kMaxNumericSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"> </span><span class="c1">// 缓冲区剩余容量只有大于这个字节数，才能继续加入缓冲数据。</span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
在 <strong><em><code>LogStream</code></em></strong> 内部定义一个缓冲区<code>buffer_</code>，将所有的 <strong><em><code>&lt;&lt;</code></em></strong> 重定向的数据都先缓冲到 <code>buffer_</code>中。因此需要经过系列的 <strong><em><code>operator&lt;&lt;(...)</code></em></strong>，来实现对各自数据类型的支持。 
缓冲区模型如图： 
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<img alt="LogStreamBuffer" src="../../Image/LogStreamBuffer.jpg" />  </p>
<h2 id="logfile">滚动日志 <strong><em>LogFile</em></strong><a class="headerlink" href="#logfile" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">LogFile</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">boost</span><span class="o">::</span><span class="n">noncopyable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">basename_</span><span class="p">;</span><span class="w">   </span><span class="c1">// 日志文件名</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">rollSize_</span><span class="p">;</span><span class="w">   </span><span class="c1">// 每个日志文件最大的大小</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flushInterval_</span><span class="p">;</span><span class="w"> </span><span class="c1">// 每次刷新日志的间隔</span>

<span class="w">        </span><span class="n">boost</span><span class="o">::</span><span class="n">scoped_ptr</span><span class="o">&lt;</span><span class="n">MutexLock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span><span class="w">   </span>

<span class="w">        </span><span class="kt">time_t</span><span class="w"> </span><span class="n">startOfPeriod_</span><span class="p">;</span><span class="w">  </span><span class="c1">// 日志的生产时间的当天零点</span>
<span class="w">        </span><span class="kt">time_t</span><span class="w"> </span><span class="n">lastRoll_</span><span class="p">;</span><span class="w">       </span><span class="c1">// 每次产生日志的时间</span>
<span class="w">        </span><span class="kt">time_t</span><span class="w"> </span><span class="n">lastFlush_</span><span class="p">;</span><span class="w">      </span><span class="c1">// 每次日志修改的时间的确切时间</span>

<span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">File</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">boost</span><span class="o">::</span><span class="n">scoped_ptr</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span><span class="w"> </span><span class="n">file_</span><span class="p">;</span><span class="w"> </span><span class="c1">// 指向日志文件的指针</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">count_</span><span class="p">;</span><span class="w"> </span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kCheckTimeRoll_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w">        </span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">kRollPerSeconds_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">;</span><span class="w">   </span><span class="c1">// 一天</span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
日志文件名通过 <strong><em><code>getLogFileName</code></em></strong> 函数获取，格式是：<code>文件名+年月日时分秒+主机名+进程id+.log</code>。
+ <code>File</code> 
    在内部有个<code>File</code>类，管理着文件及其写操作。</p>
<div class="codehilite"><pre><span></span><code><span class="err">```</span><span class="n">cpp</span><span class="w"></span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">boost</span><span class="p">::</span><span class="n">noncopyable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">private</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="n">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp_</span><span class="p">;</span><span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="err">指向打开的日志文件</span><span class="w"></span>
<span class="w">        </span><span class="nb">char</span><span class="w"> </span><span class="n">buffer_</span><span class="p">[</span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span><span class="p">];</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="err">日志文件大小</span><span class="w"> </span><span class="mi">64</span><span class="n">k</span><span class="w"></span>
<span class="w">        </span><span class="n">size_t</span><span class="w"> </span><span class="n">writtenBytes_</span><span class="p">;</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="err">已用大小</span><span class="w"></span>
<span class="w">    </span><span class="n">public</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">logline</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">向日志写</span><span class="n">lonline</span><span class="err">，其长度是</span><span class="n">len</span><span class="w"> </span>
<span class="w">        </span><span class="o">...</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>
</code></pre></div>

<ul>
<li>产生日志条件  <ul>
<li>日志的字节数到了其最大值。</li>
<li>一个日志只能记录当天记录，超过一天时间就要重新产生日志
    <code>cpp
        void LogFile::append_unlocked(const char* logline, int len) {
            file_-&gt;append(logline, len);   
            // 条件1： 超过日志大小 
            if (file_-&gt;writtenBytes() &gt; rollSize_) { 
                rollFile(); 
            }
            else {
                if (count_ &gt; kCheckTimeRoll_) {     
                    count_ = 0;
                    time_t now = ::time(NULL);
                    time_t thisPeriod_ = now / kRollPerSeconds_ * kRollPerSeconds_; 
                    //条件2：thisPeriod_ != startOfPeriod_ 说明超过一天了
                    if (thisPeriod_ != startOfPeriod_){
                        rollFile();
                    }
                    // 刷新日志
                    else if (now - lastFlush_ &gt; flushInterval_) {
                        lastFlush_ = now;
                        file_-&gt;flush();
                    }
                }
                else {
                    ++count_; 
                }
            }
        }</code></li>
</ul>
</li>
</ul>
<h2 id="logger-logfile"><strong><em>Logger &amp;&amp; LogFile</em></strong><a class="headerlink" href="#logger-logfile" title="Permanent link">&para;</a></h2>
<p>见测试文件<code>LogFile_test.cc</code>，使<code>Logger</code>的输出重定向到<code>LogFile</code>指定的文件中，
<code>cpp
    std::unique_ptr&lt;muduo::LogFile&gt; g_logFile; // 指向的是LogFile文件

    void outputFunc(const char* msg, int len) {
        g_logFile-&gt;append(msg, len);
    }

    void flushFunc() {
        g_logFile-&gt;flush();
    }</code>
整个流程：
+ 先使用<code>Logger</code>使得所有的数据缓冲到<code>stream_</code>的缓冲区中。
+ 由于宏<code>LOG_INFO</code>创建的<code>Logger</code>匿名对象在每次for循环迭代中都会析构，在析构时就将数据发发送到<code>g_LogFile</code>指定的文件中。 
    <code>c
    #define LOG_INFO \
        if (muduo::Logger::logLevel() &lt;= muduo::Logger::INFO) 
             muduo::Logger(__FILE__, __LINE__).stream()</code>
+ 下次for循环又会创建一个匿名对象，如此循环。 </p>
<hr />
<h2 id="_2">细节<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><code>gmtime_r</code>：线程安全的获取时间。
    <div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="w"> </span><span class="o">*</span><span class="n">gmtime</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">time_t</span><span class="w"> </span><span class="o">*</span><span class="n">timep</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="w"> </span><span class="o">*</span><span class="n">gmtime_r</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">time_t</span><span class="w"> </span><span class="o">*</span><span class="n">timep</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_sec</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Seconds (0-60) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_min</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Minutes (0-59) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_hour</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Hours (0-23) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_mday</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Day of the month (1-31) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_mon</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Month (0-11) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_year</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Year - 1900 */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_wday</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Day of the week (0-6, Sunday = 0) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_yday</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Day in the year (0-365, 1 Jan = 0) */</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tm_isdst</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Daylight saving time */</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
  <code>gmttime</code>函数返回的是一个指向全局静态内存区，这就导致了如果有另一个线程修改了这个数据，那么当前函数返回就不符合预期。而 <strong><em><code>gmtime_r</code></em></strong> 通过自己传入一个地址，这样就会被影响，因此是线程安全的。</p>
</li>
<li>
<p><code>strftime</code><br />
 时间格式化
    <div class="highlight"><pre><span></span><code><span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>

<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">strftime</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">max</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">format</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tm</span><span class="w"> </span><span class="o">*</span><span class="n">tm</span><span class="p">);</span><span class="w"></span>
</code></pre></div></p>
</li>
<li><code>write</code>系列<ul>
<li><code>fwrite_unlock</code>
    <div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">fwrite_unlocked</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"></span>
<span class="w">                           </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">stream</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
    其行为和<code>fwrite</code>一致，但是这是对应线程不安全的函数，其内部没有<code>lock</code>行为，因此速度更快。</li>
<li><code>pwrite</code>
    <div class="highlight"><pre><span></span><code><span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="w">    </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">pread</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="kt">off_t</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">ssize_t</span><span class="w"> </span><span class="nf">pwrite</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="kt">off_t</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
    这比<code>write</code>行为多了一个偏移量<code>offset</code>：将<code>buf</code>从文件的<code>offset</code>偏移量开始写入数据，累计写入<code>count</code>个字节。</li>
</ul>
</li>
<li>内置宏定义<ul>
<li><code>__FILE__</code>：这行代码的文件名</li>
<li><code>__LINE__</code>：这行代码的行号</li>
<li><code>__fun__</code> ： 所在函数的函数名</li>
</ul>
</li>
<li>非类型参数
    <div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">SIZE</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">FixedBuffer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">boost</span><span class="o">::</span><span class="n">noncopyable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</code></pre></div>
    这里的模板传入的参数<code>SIZE</code>是个具体的值，而不是类型。</li>
<li>
<p><strong><code>strerror_r</code></strong></p>
<p><code>c
   #include &lt;string.h&gt;
   char *strerror(int errnum);
   char *strerror_r(int errnum, char *buf, size_t buflen); /* GNU-specific */</code>
<code>strerror</code>将错误代码<code>errnum</code>转换为字符串返回，<code>strerror_r</code>是其线程安全版本，返回结果存在<code>buf</code>中。</p>
</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>